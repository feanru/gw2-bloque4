import{g as e,f as t,s as r,a as n,p as s,b as i}from"./utils-CIX5O90W.js";const a="undefined"!=typeof process&&process.env?process.env:{};var c={API_BASE_URL:a.API_BASE_URL||"https://api.guildwars2.com/v2",LANG:a.LANG||"es",MARKET_CSV_URL:a.MARKET_CSV_URL||"https://api.datawars2.ie/gw2/v1/items/csv",GW2_API_KEY:a.GW2_API_KEY||"",priceCacheStrategy:a.PRICE_CACHE_STRATEGY||"sessionStorage"};const o=c.API_BASE_URL;async function u(n=[]){if(!Array.isArray(n)||0===n.length)return[];const s=new Map,i=[];if(n.forEach(t=>{const r=e(`bundle_${t}`);r?s.set(t,r):i.push(t)}),i.length>0){const e=i.map(e=>`ids[]=${e}`).join("&");t(`/backend/api/dataBundle.php?${e}`).then(e=>e.ok?e.json():null).then(e=>{e&&e.forEach(e=>{r(`bundle_${e.id}`,e),window.dispatchEvent(new CustomEvent("bundleItemRefreshed",{detail:e}))})}).catch(e=>console.error("Error en getItemBundles:",e))}return n.map(e=>s.get(e)||null)}async function l(e){const t=Array.isArray(e)?e:[e],r=await u(t);if(Array.isArray(e))return r.map(e=>e?.recipe?[e.recipe]:[]);const n=r[0]?.recipe;return n?[n]:[]}async function p(t){const s=`recipe_${t}`,i=e(s,!0);try{const e=await n(`${o}/recipes/${t}`,{},s,i);if(!e.ok)return null;const a=await e.json();if(!a)return null;a.lastUpdated=(new Date).toISOString();const c=e.headers.get("ETag"),u=e.headers.get("Last-Modified");return r(s,a,void 0,{etag:c,lastModified:u}),a}catch(e){return console.error("Error en getRecipeDetails:",e),null}}async function d(e){if(Array.isArray(e)){return(await u(e)).map(e=>e?.item||null)}const t=await u([e]);return t[0]?.item||null}async function _(e){if(Array.isArray(e)){const t=await s(e);return e.map(e=>{const r=t.get(e)||{};return{buys:{unit_price:r.buy_price||0},sells:{unit_price:r.sell_price||0}}})}const t=await i(e);return{buys:{unit_price:t?.buy_price||0},sells:{unit_price:t?.sell_price||0}}}"undefined"!=typeof window&&(window.getRecipesForItem=l,window.getRecipeDetails=p,window.getItemDetails=d,window.getItemPrices=_,window.getItemBundles=u);var w=Object.freeze({__proto__:null,getItemBundles:u,getItemDetails:d,getItemPrices:_,getRecipeDetails:p,getRecipesForItem:l});export{c,w as r};
