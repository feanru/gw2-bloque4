import{CraftIngredient as t}from"./items-core.DsHKD_VX.min.js";import"./utils-PEkmbGsx.js";import"./services-BiP7Np88.js";const e="undefined"!=typeof self?self:globalThis;function r(t){return Array.isArray(t)?t.map(t=>l(t,null)):[]}function l(e,r){const o=new t(e);return Object.assign(o,e),"number"==typeof e._uid&&(o._uid=e._uid,t.nextUid<=e._uid&&(t.nextUid=e._uid+1)),o._parent=r||null,o.children=Array.isArray(e.children)?e.children.map(t=>l(t,o)):[],o}function o(t,e){t&&t.forEach(t=>{t.recalc(e,null)})}function a(t){let e=0,r=0,l=0;for(const o of t)switch(e+=o.total_buy||0,r+=o.total_sell||0,o.modeForParentCrafted){case"sell":l+=o.total_sell||0;break;case"crafted":l+=o.total_crafted||0;break;default:l+=o.total_buy||0}return{totalBuy:e,totalSell:r,totalCrafted:l}}e.onmessage=t=>{const{ingredientTree:l,globalQty:n}=t.data||{},i=r(l);o(i,n);const s=a(i),c=[];!function t(e){for(const r of e)c.push({uid:r._uid,total_buy:r.total_buy,total_sell:r.total_sell,total_crafted:r.total_crafted,crafted_price:r.crafted_price,countTotal:r.countTotal}),Array.isArray(r.children)&&r.children.length&&t(r.children)}(i),e.postMessage({costs:c,totals:s})};export{a as getTotals,r as rebuildTreeArray,o as recalcAll};
