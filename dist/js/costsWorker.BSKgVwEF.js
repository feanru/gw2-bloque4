import{C as t}from"./items-core-UEQOvWMv.js";import"./utils-PEkmbGsx.js";const e="undefined"!=typeof self?self:globalThis;function l(t){return Array.isArray(t)?t.map(t=>r(t,null)):[]}function r(e,l){const a=new t(e);return Object.assign(a,e),"number"==typeof e._uid&&(a._uid=e._uid,t.nextUid<=e._uid&&(t.nextUid=e._uid+1)),a._parent=l||null,a.children=Array.isArray(e.children)?e.children.map(t=>r(t,a)):[],a}function a(t,e){t&&t.forEach(t=>{t.recalc(e,null)})}function o(t){let e=0,l=0,r=0;for(const a of t)switch(e+=a.total_buy||0,l+=a.total_sell||0,a.modeForParentCrafted){case"sell":r+=a.total_sell||0;break;case"crafted":r+=a.total_crafted||0;break;default:r+=a.total_buy||0}return{totalBuy:e,totalSell:l,totalCrafted:r}}e.onmessage=t=>{const{ingredientTree:r,globalQty:n}=t.data||{},c=l(r);a(c,n);const s=o(c),i=[];!function t(e){for(const l of e)i.push({uid:l._uid,total_buy:l.total_buy,total_sell:l.total_sell,total_crafted:l.total_crafted,crafted_price:l.crafted_price,countTotal:l.countTotal}),Array.isArray(l.children)&&l.children.length&&t(l.children)}(c),e.postMessage({costs:i,totals:s})};export{o as getTotals,l as rebuildTreeArray,a as recalcAll};
